{
    "app-id": "net.davidotek.pupgui2",
    "runtime": "org.kde.Platform",
    "runtime-version": "6.2",
    "sdk": "org.kde.Sdk",
    "sdk-extensions": [
        "org.freedesktop.Sdk.Extension.llvm12"
    ],
    "command": "net.davidotek.pupgui2",
    "finish-args": [
        "--share=ipc",
        "--share=network",
        "--socket=wayland",
        "--filesystem=~/.steam",
        "--filesystem=~/.local/share/Steam",
        "--filesystem=~/.var/app/com.valvesoftware.Steam/data/Steam",
        "--filesystem=~/.var/app/net.lutris.Lutris/data/lutris/runners/wine",
        "--filesystem=~/.var/app/net.lutris.Lutris/data/lutris/pga.db:ro",
        "--filesystem=~/.var/app/net.lutris.Lutris/config/lutris:ro",
        "--filesystem=~/.local/share/lutris/runners/wine",
        "--filesystem=~/.local/share/lutris/pga.db:ro",
        "--filesystem=~/.config/lutris:ro",
        "--filesystem=~/.var/app/com.usebottles.bottles/data/bottles/runners",
        "--filesystem=~/.config/heroic/tools",
        "--filesystem=~/.var/app/com.heroicgameslauncher.hgl/config/heroic/tools",
        "--device=all"
    ],
    "modules": [
        "python3-requests.json",
        "python3-vdf.json",
        "python3-inputs.json",
        "python3-pyxdg.json",
        "python3-packaging.json",
        "python3-steam.json",
        "python3-PyYAML.json",
        {
            "name": "shiboken6",
            "buildsystem": "simple",
            "build-options": {
                "prepend-path": "/usr/lib/sdk/llvm12/bin",
                "prepend-ld-library-path": "/usr/lib/sdk/llvm12/lib"
            },
            "build-commands": [
                "python3 setup.py install --verbose-build --skip-docs --build-type=shiboken6 --prefix=${FLATPAK_DEST}"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/qtproject/pyside-pyside-setup.git",
                    "branch": "6.2.4",
                    "commit": "4c7d937cc9740fe6e6f47c9bb59401519c39d860"
                }
            ]
        },
        {
            "name": "pyside6",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "build-options": {
                "prepend-path": "/usr/lib/sdk/llvm12/bin",
                "prepend-ld-library-path": "/usr/lib/sdk/llvm12/lib"
            },
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=Release",
                "-DBUILD_TESTS=OFF",
                "-DCMAKE_SKIP_RPATH:BOOL=YES"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/qtproject/pyside-pyside-setup.git",
                    "branch": "6.2.4",
                    "commit": "4c7d937cc9740fe6e6f47c9bb59401519c39d860"
                },
                {
                    "type": "shell",
                    "commands": [
                        "mkdir -p /app/include/qt6tmp && cp -R /usr/include/Qt* /app/include/qt6tmp",
                        "sed -i 's|--include-paths=|--include-paths=/app/include/qt6tmp:|' sources/pyside6/cmake/Macros/PySideModules.cmake",
                        "sed -i 's|<signature_p.h>|<signature/signature_p.h>|' sources/pyside6/libpyside/feature_select.cpp"
                    ]
                }
            ]
        },
        {
            "name": "pupgui2",
            "buildsystem": "simple",
            "build-commands": [
                "mkdir -p /app/share",
                "cp -r share /app/",
                "sed -i '/PySide6/d' setup.cfg",
                "sed -i \"s/BUILD_INFO = .*/BUILD_INFO = 'DavidoTek Flathub build'/\" pupgui2/constants.py",
                "pip3 install --verbose --no-index --prefix=${FLATPAK_DEST} --no-build-isolation ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/DavidoTek/ProtonUp-Qt/archive/refs/tags/v2.6.5.tar.gz",
                    "sha256": "598b03a2577e1572a251b798bcf9f0b8dae9b2db41e7435e6ca5a9f40209442b"
                }
            ]
        },
        {
            "name": "pupgui2-desktop",
            "buildsystem": "simple",
            "build-commands": [
                "install -D pupgui2.sh /app/bin/net.davidotek.pupgui2"
            ],
            "sources": [
                {
                    "type": "file",
                    "path": "pupgui2.sh"
                }
            ]
        }
    ]
}
